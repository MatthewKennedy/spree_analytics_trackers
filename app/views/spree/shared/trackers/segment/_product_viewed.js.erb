<% if tracker = Spree::Tracker.current(:segment) %>
  <script>
    if (typeof analytics !== 'undefined') {

      analytics.page("Product Viewed");
      analytics.track('Product Viewed', {
          ecomm_pagetype: 'product',
          product_id: '<%= @product.sku %>',
          sku: '<%= @product.sku %>',
          name: '<%= @product.name %>',
          price: <%= @product.price.to_f %>,
          currency: '<%= current_currency %>',
          url: '<%= product_url(@product) %>',
          image_url: <% @product.images.first(1).each do |i| %>'<%= main_app.url_for(i.url(:product)) %>'<% end %>
        });

      }
  </script>
<% end %>
