<% if tracker = Spree::Tracker.current(:segment) %>
  <script>
    if (typeof analytics !== 'undefined') {

      analytics.page("Product List Viewed");
      analytics.track('Product List Viewed', {
        category: '<%= @taxon.try(:name) %>',
        products: [
        <% products.each_with_index do |product, index| %>
          <%= product_for_segment(product, position: index+1, image: product.images.first) %>,
        <% end %>
        ]
      });

    }
  </script>
<% end %>
