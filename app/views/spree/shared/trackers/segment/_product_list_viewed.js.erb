<% if tracker = Spree::Tracker.current(:segment) %>
  <script>
    if (typeof analytics !== 'undefined') {

      analytics.track('Product List Viewed', {
        category: '<%= @taxon.try(:name) %>',
        products: [
        <% products.each_with_index do |product, index| %>
          <%= product_for_segment(product, position: index+1, image: product.images.first) %>,
        <% end %>
        ]
      });

    }
  </script>

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('event', 'page_view', {'send_to': 'AW-992696821',
     'ecomm_pagetype': 'category',
    });
  </script>
<% end %>
